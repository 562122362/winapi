# 本项目在错误显示上的一个小优势 #

## 错误码 ##
在用C/C++进行Windows编程时，经常会用到`错误码`，即函数`GetLastError`的返回值。如果要知道错误码所表达的意思，可以通过MSDN来查询。如果要把错误码转化为字符串在程序中显示，可以用函数`FormatMessage`。

例如：
<pre>
wchar_t b[200] = {};
FormatMessage(flags, 0, GetLastError(), 0, b, 200, nullptr);
</pre>

不过，这个方法小麻烦。<br>

我在本项目中提供了`WinErrorCode`类型
<pre>
type WinErrorCode uint32
</pre>
它实现了`error`接口：
<pre>
func (this WinErrorCode) Error() string {
    var flags uint32 = FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ARGUMENT_ARRAY | FORMAT_MESSAGE_IGNORE_INSERTS
    str, err := FormatMessage(flags, nil, uint32(this), 0, nil)
    n := uint32(this)
    if err == nil {
        return fmt.Sprintf("error %d(0x%08X) - ", n, n) + str
    } else {
        return fmt.Sprintf("winapi error. GetLastError() == %d", uint32(this))
    }
}
</pre>
这样，不管你想要错误码还是描述字符串，都是轻松加愉快的。
<pre>
var e WinErrorCode = 5
fmt.Println(n) // error 5(0x00000005) - 拒绝访问。
</pre>

## HRESULT ##
在Windows中另一个常用的错误类型是`HRESULT`：
<pre>
typedef HRESULT int32_t;
</pre>
我为`HRESULT`类型也实现了`error`接口：
<pre>
type HRESULT int32

func (hr HRESULT) Error() string {
    var flags uint32 = FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ARGUMENT_ARRAY | FORMAT_MESSAGE_IGNORE_INSERTS
    str, err := FormatMessage(flags, nil, uint32(hr), 0, nil)
    if err == nil {
        return str
    } else {
        return fmt.Sprintf("error: HRESULT = %d(0x%08X)", int32(hr), uint32(hr))
    }
}
</pre>

## 好处 ##
做成接口的好处是显而易见的，例如，有个打印错误的函数`func ShowError(e error)`，则`WinErrorCode`和`HRESULT`类型都可以扔进去。<br>
还有很多细节上的好处，慢慢体会吧^_^